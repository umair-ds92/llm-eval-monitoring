# Production Configuration
environment: prod

# Database Configuration
database:
  url: "postgresql://llm_eval:llm_eval_pass@postgres:5432/llm_eval"
  echo: false
  pool_size: 20
  max_overflow: 40
  pool_pre_ping: true

# Redis Configuration (for caching)
redis:
  url: "redis://redis:6379/0"
  max_connections: 50
  socket_timeout: 5
  socket_connect_timeout: 5

# Model Configuration
models:
  default: "claude-sonnet-4"
  timeout: 60
  max_retries: 3
  max_tokens: 4096
  temperature: 0.0
  
  available:
    - "claude-sonnet-4"
    - "claude-opus-4"
    - "gpt-4"
    - "gpt-4-turbo"
  
  rate_limits:
    requests_per_minute: 100
    tokens_per_minute: 100000

# Evaluator Configuration
evaluators:
  enabled:
    - latency
    - toxicity
    - factuality
  
  # Latency Evaluator
  latency:
    enabled: true
    thresholds:
      mean_ms: 1000
      p50_ms: 800
      p95_ms: 1500
      p99_ms: 3000
    alert_on_exceed: true
  
  # Toxicity Evaluator
  toxicity:
    enabled: true
    model: "unitary/toxic-bert"
    threshold: 0.5  # Stricter in prod
    categories:
      - "toxic"
      - "severe_toxic"
      - "obscene"
      - "threat"
      - "insult"
      - "identity_hate"
    cache_results: true
    batch_size: 16
  
  # Factuality Evaluator
  factuality:
    enabled: true
    use_llm_judge: true
    judge_model: "claude-opus-4"  # Better model for prod
    threshold: 0.9  # Stricter in prod
    fallback_to_similarity: true
    max_retries: 2
  
  # Semantic Similarity Evaluator
  semantic_similarity:
    enabled: false
    model: "sentence-transformers/all-mpnet-base-v2"
    threshold: 0.85
    cache_embeddings: true
    batch_size: 32
  
  # IOC Extraction Evaluator (Cybersecurity-specific)
  ioc_extraction:
    enabled: true
    ioc_types:
      - "ipv4"
      - "ipv6"
      - "domain"
      - "url"
      - "email"
      - "md5"
      - "sha1"
      - "sha256"
      - "cve"
      - "file_path"
    
    min_precision: 0.8
    min_recall: 0.7
    min_f1: 0.75
    
    whitelist_domains:
      - "example.com"
      - "localhost"
      - "test.local"

# Cybersecurity-Specific Settings
cybersecurity:
  ioc_types:
    - "ip_address"
    - "domain"
    - "url"
    - "file_hash"
    - "cve_id"
    - "malware_family"
    - "email"
  
  threat_intel:
    sources:
      - "malware_bazaar"
      - "mitre_attack"
      - "cve_database"
    update_interval_hours: 24
  
  malware_analysis:
    sandbox_timeout_seconds: 300
    max_file_size_mb: 100
    allowed_file_types:
      - "exe"
      - "dll"
      - "pdf"
      - "doc"
      - "docx"
  
  ioc_patterns:
    ipv4: '\b(?:\d{1,3}\.){3}\d{1,3}\b'
    domain: '\b[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z]{2,})+\b'
    md5: '\b[a-fA-F0-9]{32}\b'
    sha256: '\b[a-fA-F0-9]{64}\b'
    cve: '\bCVE-\d{4}-\d{4,7}\b'

# Monitoring & Alerting
monitoring:
  enabled: true
  alert_cooldown_seconds: 1800  # 30 minutes
  metrics_retention_days: 365
  
  metrics:
    collection_interval_seconds: 60
    retention_days: 180
    aggregation_windows:
      - "1m"
      - "5m"
      - "1h"
      - "1d"
  
  alerts:
    enabled: true
    
    channels:
      slack:
        enabled: false
        webhook_url: "${SLACK_WEBHOOK_URL}"
      
      email:
        enabled: false
        smtp_host: "smtp.gmail.com"
        smtp_port: 587
        from_address: "alerts@example.com"
        to_addresses:
          - "oncall@example.com"
      
      pagerduty:
        enabled: false
        api_key: "${PAGERDUTY_API_KEY}"
    
    rules:
      high_latency:
        metric: "latency_p95"
        threshold: 2000
        duration: 300
        severity: "warning"
      
      high_toxicity_rate:
        metric: "toxicity_rate"
        threshold: 0.05
        duration: 600
        severity: "critical"
      
      low_factuality:
        metric: "factuality_avg"
        threshold: 0.8
        duration: 600
        severity: "warning"
      
      evaluation_failures:
        metric: "evaluation_error_rate"
        threshold: 0.05
        duration: 300
        severity: "critical"

# API Configuration
api:
  host: "0.0.0.0"
  port: 8000
  workers: 4
  
  cors:
    allow_origins:
      - "https://yourdomain.com"
      - "https://dashboard.yourdomain.com"
    allow_credentials: true
    allow_methods: ["GET", "POST", "PUT", "DELETE"]
    allow_headers: ["*"]
  
  rate_limit:
    enabled: true
    requests_per_minute: 100
    burst: 20
  
  auth:
    enabled: true
    jwt_secret: "${JWT_SECRET}"
    jwt_algorithm: "HS256"
    token_expire_minutes: 60

# Logging Configuration
logging:
  level: "WARNING"
  format: "json"
  
  files:
    api: "/var/log/llm-eval/api.log"
    evaluators: "/var/log/llm-eval/evaluators.log"
    errors: "/var/log/llm-eval/errors.log"
  
  rotation:
    max_bytes: 104857600  # 100MB
    backup_count: 10
  
  external:
    datadog:
      enabled: false
      api_key: "${DATADOG_API_KEY}"
    
    elasticsearch:
      enabled: false
      hosts: ["http://elasticsearch:9200"]

# Performance & Optimization
performance:
  cache:
    enabled: true
    ttl_seconds: 3600
    max_size_mb: 1024
  
  async_workers: 10
  max_concurrent_evaluations: 50
  database_batch_size: 100
  query_timeout_seconds: 30

# Feature Flags
features:
  drift_detection: false
  ab_testing: false
  auto_retraining: false
  advanced_analytics: true
  export_metrics: true

# Data Retention
data_retention:
  evaluations_days: 90
  metrics_days: 365
  alerts_days: 30
  
  archive:
    enabled: true
    storage: "s3"
    bucket: "llm-eval-archives"
    compression: true

# Security
security:
  secrets_provider: "env"
  encrypt_at_rest: true
  encrypt_in_transit: true
  api_key_rotation_days: 90
  
  audit_log:
    enabled: true
    log_all_requests: false
    log_sensitive_data: false